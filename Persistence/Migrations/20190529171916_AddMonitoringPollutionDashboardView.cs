using Microsoft.EntityFrameworkCore.Migrations;

namespace Persistence.Migrations
{
    public partial class AddMonitoringPollutionDashboardView : Migration
    {
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            var cmd = @"CREATE VIEW v_monitoringpollutiondashboard AS 
                   select `ostanenums`.`Title` AS `Province`,`iusr`.`MonitoringYear` AS `MonitoringYear`,`monitoringperiods`.`Title` AS `PeriodTitle`,`monitoringperiods`.`Id` AS `PeriodId`,count(`iusr`.`Id`) AS `TotalPollution`,coalesce((select count(distinct `industrialunitssamplingresults`.`Id`) from (((`industrialunitssamplingresults` join `parameterssamplingresults` `psr` on((`industrialunitssamplingresults`.`Id` = `psr`.`IndustrialUnitsSamplingResultId`))) join `monitoringparameters` `mp` on((`mp`.`Id` = `psr`.`MonitoringParametersId`))) join `ambientairparametersresults` `amb` on((`amb`.`ParametersSamplingResultsId` = `psr`.`Id`))) where ((`industrialunitssamplingresults`.`Id` = `iusr`.`Id`) and (`industrialunitssamplingresults`.`FinalSave` = 1) and (`amb`.`Quantity` > `mp`.`PollutionLimitQuantity`))),0) AS `AmbientAirPollution`,coalesce((select count(distinct `industrialunitssamplingresults`.`Id`) from (((`industrialunitssamplingresults` join `parameterssamplingresults` `psr` on((`industrialunitssamplingresults`.`Id` = `psr`.`IndustrialUnitsSamplingResultId`))) join `monitoringparameters` `mp` on((`mp`.`Id` = `psr`.`MonitoringParametersId`))) join `chimneyparametersresults` `chm` on((`chm`.`ParametersSamplingResultsId` = `psr`.`Id`))) where ((`industrialunitssamplingresults`.`Id` = `iusr`.`Id`) and (`industrialunitssamplingresults`.`FinalSave` = 1) and (`chm`.`Quantity` > `mp`.`PollutionLimitQuantity`))),0) AS `ChimneyPollution`,coalesce((select count(distinct `industrialunitssamplingresults`.`Id`) from (((`industrialunitssamplingresults` join `parameterssamplingresults` `psr` on((`industrialunitssamplingresults`.`Id` = `psr`.`IndustrialUnitsSamplingResultId`))) join `monitoringparameters` `mp` on((`mp`.`Id` = `psr`.`MonitoringParametersId`))) join `wasteparametersresults` `waste` on((`waste`.`ParametersSamplingResultsId` = `psr`.`Id`))) where ((`industrialunitssamplingresults`.`Id` = `iusr`.`Id`) and (`industrialunitssamplingresults`.`FinalSave` = 1) and (`waste`.`Quantity` > `mp`.`PollutionLimitQuantity`))),0) AS `WastePollution`,coalesce((select count(distinct `industrialunitssamplingresults`.`Id`) from (((`industrialunitssamplingresults` join `parameterssamplingresults` `psr` on((`industrialunitssamplingresults`.`Id` = `psr`.`IndustrialUnitsSamplingResultId`))) join `monitoringparameters` `mp` on((`mp`.`Id` = `psr`.`MonitoringParametersId`))) join `wastewaterparametersresults` `ww` on((`ww`.`ParametersSamplingResultsId` = `psr`.`Id`))) where ((`industrialunitssamplingresults`.`Id` = `iusr`.`Id`) and (`industrialunitssamplingresults`.`FinalSave` = 1) and (`ww`.`Quantity` > `mp`.`PollutionLimitQuantity`))),0) AS `WastewaterPollution`,coalesce((select count(distinct `industrialunitssamplingresults`.`Id`) from (((`industrialunitssamplingresults` join `parameterssamplingresults` `psr` on((`industrialunitssamplingresults`.`Id` = `psr`.`IndustrialUnitsSamplingResultId`))) join `monitoringparameters` `mp` on((`mp`.`Id` = `psr`.`MonitoringParametersId`))) join `soundandwavesparametersresults` `sw` on((`sw`.`ParametersSamplingResultsId` = `psr`.`Id`))) where ((`industrialunitssamplingresults`.`Id` = `iusr`.`Id`) and (`industrialunitssamplingresults`.`FinalSave` = 1) and (`sw`.`Quantity` > `mp`.`PollutionLimitQuantity`))),0) AS `SoundAndWavesPollution` from (`enumdata` `ostanenums` left join (((`industrialunitssamplingresults` `iusr` join `industries` on((`industries`.`Id` = `iusr`.`IndustryId`))) join `industry_workshopaddresses` on((`industry_workshopaddresses`.`IndustryId` = `industries`.`Id`))) join `enumdata` `monitoringperiods` on((`iusr`.`MonitoringPeriodId` = `monitoringperiods`.`Id`))) on((`industry_workshopaddresses`.`ProvinceId` = `ostanenums`.`Id`))) where (`ostanenums`.`SystemType` = 5) group by `ostanenums`.`Title`,`iusr`.`MonitoringYear`,`iusr`.`MonitoringPeriodId`";
            migrationBuilder.Sql(cmd);
        }

        protected override void Down(MigrationBuilder migrationBuilder)
        {
            var cmd = @"DROP VIEW IF EXISTS `v_monitoringpollutiondashboard`;";
            migrationBuilder.Sql(cmd);
        }
    }
}
